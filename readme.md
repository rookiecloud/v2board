# 更新日志

### 标签含义🔴需要手动操作的更新信息
🟡需要注意的更新信息
🟢已修复的问题

### v1.7.4

🟡️更新后流量记录将从原有的实时，变更成次日生成昨日流量记录。如记录没有正常生成将会在更新日的下一个0时生成。
🟢修复排序问题
🟢修复有手续费切换至无手续费支付方式时手续费依然存在的问题
🟢默认Clash配置enhanced mode强制为fake-ip
💡新增Hysteria协议
💡优化排序算法
💡优惠券为批量生成时将默认启用
💡性能优化
💡API新增日志管理
💡优化统计算法

### v1.7.3

🟢修复用户侧节点状态显示问题
🟢修复邮箱验证允许空格的问题
🟢修复Clash订阅在proxies空时导致无法订阅的问题
💡订单列表取消订单时提示
💡优化订单折价算法
💡节点排序算法优化
💡兼容ClashX废弃的配置

### v1.7.2

🟡️主题作者需将主题下config.php文件转换为config.json格式
🟢修复编辑节点路由无法清空的问题
🟢修复试用套餐没有分发限速的问题
💡支持V2rayN 2022配置下发
💡移除google analytics统计
💡防字典攻击参数可自定义(该功能默认开启)
💡分离安全设置到独立页面
💡AlipayF2F 自定义商品名称
💡新增支持Clash Meta订阅。

### v1.7.1

### 🟢修复路由匹配域名长度限制问题
🟢修复限速参数没有下发的问题
💡优化session过期的问题，后续将由session管理器取代
💡新增重置所有用户订阅密钥命令行。对于1.6.1有数据泄露的问题可以执行 **php artisan reset:user** 进行用户订阅信息重置

### v1.7.0

🔴**重大安全更新，涉及版本1.6.1请务必更新，务必修改使用过的支付密钥、通讯密钥及检查是否有异常管理员**
🔴**如果您从来没有改过后台路径，重新执行 php artisan v2board:install 可以看到您默认的管理员登陆后台路径，修改过则使用原有的后台路径登录即可**
🟡️移除旧版v2ray全局域名过滤器、v2ray全局协议过滤器由路由取代
🟢修复达到套餐最大限制时无法续费的问题
🟢修复用户侧佣金统计显示问题
🟢修复当重置包不存在时显示流量重置的问题
💡新增波斯语
💡新增限速(需服务端支持)
💡新增shadowsocks 2022 cipher(需服务端支持)
💡新增路由组功能，审计等规则均可通过此完成(需服务端支持)
💡安全更新：为了避免弱口令导致的问题首次安装面板时输入管理员密码修改成由系统随机设置
💡安全更新：当密码错误超过5次时，它将被限制30分钟
💡安全更新：安全路径现在对所有的路由生效
💡新增管理员检索项

### v1.6.1

🟢修复优惠券可能在产生并发时无法正确减少库存的问题
🟢修复后台流量排行计算倍率的问题
🟢优化工单自动关闭需满足条件(>=24小时用户未回复)
💡UI优化
💡新增套餐最大可容纳用户量，人满自动下架
💡套餐过期7天以上的用户将会被清空套餐及权限组信息
💡隐藏重置流量包入口改为如下，防止产生不必要的客户请求
💡优化当流量达到80%以上时如套餐支持重置流量将会给予提示
💡管理员查询用户流量记录
💡使用文档模糊搜索
💡TG有效用户加群审核
💡支付方式排序
💡支持CFW新特性打开webpage
💡工单系统逻辑优化
💡细节优化
💡Stripe Checkout

### v1.6.0

🔴️本次更新需要对主题进行重新配置
🔴️主题作者需要兼容新的主题配置方式
🔴️使用官方主题配置Crisp需要通过主题配置->自定义页脚HTML进行配置
🔴️更新完成后报错500需要重新设置主题方可访问用户端
🔴️支付通知域名默认为后台设置站点域名，可以在支付网关自定义通知域名
🟡️主题配置的形式进行了重构
🟢修复知识库安全区显示问题
🟢修复昨日节点流量统计显示问题
🟢修复后台佣金统计逻辑问题
🟢修复支付图标长宽比的问题
🟢修复一次性套餐折抵时根据套餐原价换算的问题
💡移除hitokoto
💡新增后台管理员密码重置
💡修复优惠券批量生成的问题
💡支付网关支持配置浮动/固定网关手续费
💡优化用户统计逻辑
💡新增针对IP注册数量限制
💡统计数据优化降低数据库负载
💡新增公告标签当标签包含“弹窗”时，公告将会弹窗
💡UI布局更新
💡一键订阅UI优化
💡购买界面新增分类
💡交互逻辑优化
💡底层框架更新至Laravel 8
💡工单过滤
💡主题配置模块化
💡自定义LOGO
💡新增2种流量重置方式
💡自定义是否在订阅时输出订阅信息

### v1.5.5

🟡️当前版本更新后需要重新确认需要显示的公告或启用的优惠券。
🟢修复流量重置倒数日在特定配置下无法显示的问题
🟢修复流量统计可能无法被统计到的问题
🟢修复在开启佣金三级后可能导致佣金显示和统计不准确的问题
🟢修复订阅重置方式存在的问题
🟢修复知识库css丢失的问题
🟢修复按量订阅在折抵时某些场景计算错误的问题
🟢修复套餐重置类型为月初重置无效的问题
💡移除alterid配置项改为0
💡v2board主题assets目录下创建custom.css及custom.js可以自定义css及js
💡当没有重置包时隐藏购买重置流量入口
💡优化流量明细页面
💡兼容新旧Clash配置格式
💡V2Board中的Clash Proxies正则匹配优化
💡用户管理流量排序优化对上行的排序
💡节点管理筛选
💡节点管理分页
💡工单关闭后管理员回复后开启工单
💡管理员回复工单后用户24小时没有回复工单自动关闭
💡当面付SDK重构
💡新增优惠券启用开关
💡新增公告显示开关
💡Telegram机器人命令模块化
💡新增韩语 @Xan1982、繁体中文
💡移除了看腻了的登入页面
💡优化流量统计方式
💡预增用户数据统计
💡支付网关可以自定义通知域名
💡新增CoinPayments网关 @alphacat
💡新增BitPay 网关 #505
💡新增Coinbase网关 #504

### v1.5.4

🟢修复context menu错误弹出问题
🟢修复v2ray协议配置格式错误未提示的问题
🟢修复后台添加用户时没有判断用户是否存在的问题
🟢修复V2ray配置DNS无法删除的问题
🟢修复他的邀请无法点击的问题
🟢修复优惠券优惠金额超过订单金额的问题
🟢修复黑夜模式下二维码显示问题
🟢修复Telegram发送Markdown消息时存在的转义问题
🟢修复套餐在设置不重置时前端还显示重置日期的问题
💡新增黑夜模式
💡订单过滤器新增回调单号过滤
💡自定义货币单位和符号，比如BTC/₿
💡新增邮件发信测试
💡选择器UI优化
💡新增支付图标
💡在V2Board的Clash配置中Proxies支持通过正则匹配节点名称过滤
💡复制邀请UI优化
💡剥离多语言(希望能有人持续贡献)
💡新增Telegram讨论组设置及入口
💡优化群发邮件与验证邮件优先级
💡支持了新的代理工具Stash
💡节点排序逻辑优化
💡优惠券可以限制付款周期了
💡前端操作逻辑优化

### v1.5.3

🔴本次升级需要安装php fileinfo扩展
🔴流量计费逻辑更改为队列进行。按照文档使用pm2队列的用户只需要重新添加pm2配置即可。自定义配置队列的用户请注意队列命令的更新。
🟡️移除教程AppleID配置，由知识库有效用户可视区域取代
🟢修正订单统计时的逻辑问题
🟢修复后台复制用户订阅链接的问题
🟢修复gRPC订阅问题
🟢修复工单消息长度问题并支持emoji
💡用户端UI优化
💡管理端目前高频使用的表格均可以进行鼠标右键快捷操作
💡框架升级
💡数据结构优化
💡新增绿色配色
💡知识库支持传入id时自动打开
💡优惠券可以对每个用户使用次数进行限制
💡新增Horizon来管理队列
💡流量扣费逻辑交由队列处理更加精准
💡现在订单可以在最快的速度在队列中直接处理完成
💡月流量重置方式新增：不重置
💡佣金三级分成
💡现在可以对订阅单独设置重置流量的方式

### v1.5.2

🔴️移除V2rayN、V2rayNG等无法识别客户端类型的订阅（移除缓冲期，版本<1.5.3以前还可用，>=1.5.3后将会移除，1.5.3后可以通过flag参数来指定订阅）
🔴️移除Quantumult订阅方式（非QuantumultX）
🔴️移除始终重置订阅流量配置项，由自定义处理事件取代
🟢修复多语言无法根据浏览器自动识别本地语言的问题
🟢修复订阅编辑时存在的问题
🟢修复佣金统计存在的问题
🟢修复历史折抵金额没有在新的订单中折抵的问题
💡优化在检查订单时获取过多数据量的问题
💡用户端UI体验优化
💡支持clash部分客户端显示流量
💡使用TG回复工单时会告知其他员工及管理员谁回复了工单避免重复回复
💡新增原生微信支付(WechatPayNative)
💡UI布局优化
💡移动端体验优化
💡新增新购、续费、变更时自定义处理事件
💡用户过滤器对备注进行过滤
💡工单聊天对话框可以进行多开了
💡支持Vmess gRPC传输协议
💡新增多订阅URL随机获取其一进行订阅
💡现在可以对用户单独设置返佣形式
💡现在可以在后台对兼容的主题进行配置

### v1.5.1

🔴我们重构了支付模块，移除了旧的支付配置方式，您需要进行新的支付方式配置
🟢修复统计问题
🟢修复节点流量统计排行问题
🟢修复用户管理筛选用户后查看用户订单没有清空筛选的问题
🟢隐藏用户侧接口可以浏览到自增id
🟢诸多优化
💡新增节点数据上报状态
💡新增订单过滤器
💡合并订单、佣金管理
💡现在可以在站点配置->前端 配置 crisp 客服系统
💡新增TOS配置
💡知识库新增仅对有效订阅用户展示指定内容的方式

### v1.5.0

🔴本次修复逻辑问题导致的可能被利用的漏洞

### v1.4.3

🟡️本次更新需要重启队列服务
🟢修复ws+tls情况下quantumult-x的订阅问题
🟢修复用户编辑时光标存在的问题
🟢修复用户端流量倍率显示问题
🟢部分代码、订阅优化
🟢修复在优惠券选择有阅时的错误问题
🟢修复在某些情况导致的前端重置倒计时显示问题
💡新增统计图表
💡用户管理过滤器字段更新
💡新增用户管理重置用户安全信息
💡提现方式自定义
💡现在只要你使用crisp或tawk它们将会自动获取到email信息，后续将会支持更多信息
💡后端多语言，目前仅补充中文
💡用户端订单状态UI优化
💡用户备注
💡现在可以决定是否关闭佣金提现
💡登录注册页可以进行语言切换了

### v1.4.2

🟢修复节点管理无法访问的问题
💡用户通过订阅搜索
💡子节点底色区别
💡快速复制用户订阅地址
💡优化节点管理

### v1.4.1

🟡️由于新增了自定义alterid，旧版本id统一为2，新版本修改为默认为1，可以在节点配置进行修改
🟢修复流量提醒被除数可能为0的问题
🟢修复优惠券管理分页问题
🟢修复仪表盘数据统计问题
🟢修复在某种情况可能导致的流量上报问题
🟢修复因折抵导致订单被判定非首次发放佣金的问题
🟢修复因折抵导致的佣金无法发放的问题
🟢修复iPad快捷订阅识别问题
🟢修复Vmess订阅默认配置问题
💡用户管理优化
💡新增当用户过期且订阅关闭销售及允许续费的情况下则无法续费的逻辑
💡优化流量上报逻辑
💡优化过滤器交互
💡节点管理重构
💡优化佣金操作逻辑
💡后台UI更新
💡V2ray alter id现在可以在节点配置自行配置
💡增加ss原版客户端订阅@pr#344
💡默认规则优化
💡用户端提示逻辑优化
💡优化订阅逻辑
💡优化内置默认订阅规则

### v1.4

🟡️移除教程模块由知识库取代
🟢修复一次性订阅转换到循环订阅折抵无效的问题
🟢修复在某些情况下可能导致将已过期订单计入折抵的问题
🟢修复流量使用80%时邮件通知失效的问题
🟢修复当流量重置方式为每月1号时失效的问题
🟢修复关闭续费的情况下无法购买重置包的问题
🟢优化在订阅过期可以购买重置包的逻辑
💡新增Shadowsocks
💡订阅新增2年付3年付周期
💡邮箱模糊搜索
💡新增员工角色（目前仅支持员工通过TG接收回复工单）
💡新增用户管理过滤器
💡新增用户生成创建
💡新增Google reCAPTCHA，用于注册及发件验证
💡用户端新增中英日越四国语言
💡根据浏览器语言自动切换语言，默认中文
💡新增知识库
💡现在自由选择是否开启折抵功能
💡新增封禁功能
💡优惠券批量创建导出
💡新增佣金提现门槛限制

### v1.3.2

🟢修复用户编辑过期时间选择器数据滞后的问题
🟢修复新建优惠券时可能带来的问题
🟢修复Trojan子节点在线数不跟随父节点的问题
🟢修复vmess规则可能导致的某些问题
🟢修复quantumultx无法导入wss的问题
🟢修复单个账号可以绑定多个Telegram的问题
🟢修复用户过期后新购不重置流量的问题
💡Stripe支持JPY货币
💡未分离情况下，可以更改管理端路径
💡新增易支付接口
💡新增mGate支付接口
💡前端优化
💡父子节点明显区分
💡V2ray全局审计配置
💡telegram工单回复
💡telegram订单通知
💡清空日志计划任务周期更改为季度
💡用户端新增重置倒数日
💡telegram解绑
💡smtp配置可视化

### v1.3.1

🔴原Stripe用户需要配置source.chargeable 和 charge.succeeded事件
🔴V2ray及Trojan证书在节点存放位置修改为：/root/.cert/server.crt及/root/.cert/server.key
🟡️移除Quantumult订阅
🟡️由于Clash1.0更新了配置档格式，该版本已经升级到新的配置档格式，可能会对远古Clash版本不兼容。
🟢修复更改分页后搜索无法显示的问题
💡优化周期性订阅更换为一次性订阅时将会清空流量
💡支持Stripe信用卡支付
💡节点在线用户统计
💡支持Trojan协议
💡Trojan的QuantumultX支持
💡Trojan的Clash支持
💡Trojan的Shadowrocket支持
💡Trojan的Surge支持
💡优惠券支持根据订阅计划做限制
💡Telegram新增获取最新官网命令
💡优惠券支持自定义优惠码
💡优化用户端体验
💡订阅现在可以查看订阅下用户统计

### v1.3

🔴有进行过前后端分离的用户需要重新配置env
🟡️修改了更换订阅的算法
🟢[#193](https://github.com/v2board/v2board/issues/193)清空审计规则后无法连接的问题
🟢[#176](https://github.com/v2board/v2board/issues/176)DNS端口string类型的问题
🟢修复订阅价格为0时重新保存数据丢失的问题
🟢修复iPad无法一键订阅的问题
🟢修復用戶訂單端可能存在pooling問題
🟢诸多修复
💡订阅、节点、教程现在可以拖拽进行排序了
💡Clash的自定义形式发生了变化
💡流量重置包上线
💡用户、工单分页分类优化
💡可以在設置確定是否自動確認3天前的佣金
💡工單體驗優化
💡优化UI加载效果
💡新增佣金畫傳及提現功能
💡优化管理端仪表盘
💡新增订单分配功能
💡日志记录方式优化
💡工单回复邮件提醒
💡支持Telegram
💡诸多优化
💡自定义是否禁止Gmail别名注册
💡服务端全局日志等级配置

### v1.2.5

🟢修复DNS规则端口修改后无法使用的问题
🟢修复surge存在的问题
🟢修复TLS配置存在的问题
💡[#170](https://github.com/v2board/v2board/issues/170)
💡[#148](https://github.com/v2board/v2board/issues/148)邮件队列发送间隔更新为2秒

### v1.2.4

🟢修复用户端存在订单polling重复监听的问题
🟢修复审计规则无法使用的问题
🟢修复用户端工单状态问题
🟢修复订阅日重置无效的问题
🟢修复Stripe货币无法生效的问题
🟢修复提醒邮件所存在的问题
💡优化更换订阅算法，更加精准
💡新增V2ray配置预览
💡审计/DNS规则的输入由select形式变更为textarea
💡现在可以为你的节点配置DNS了
💡Stripe支持欧元
💡支持Surge/Surfboard订阅 @alphacat
💡优化多平台一键订阅

### v1.2.3

🔴邮件队列名变更，需要重启队列服务
🟢修复客户端快速登录无法登录的问题
🟢修复编辑规则无法使用的问题
🟢修复节点标签无法清空的问题
🟢修复月流量重置方式为订单日无法重置的问题
🟢修复工单回复状态问题
🟢修复quan和quanx，ws+tls无法连接的问题
💡现在TLS的部分配置可以进行设置
💡现在你可以决定佣金是否只在用户首次付费是给予(默认仅在用户首次付费给予)
💡现在邮箱验证码的有效时间为5分钟且验证码以数字呈现
💡现在可以用余额进行支付了(有余额优先使用余额)
💡现在你可以自定义邮件模板了

### v1.2.2

🟢修复订阅金额精度问题
🟢修复权限组无法删除的问题
🟢移除日志记录对目录权限的强依赖

### v1.2.1

🟢修复UI在权限组编辑后没有重置的问题
🟢修复订阅才某些情况下保存失败的问题
🟢修复审计规则才某些情况下保存失败的问题
🟢修复公告背景添加后不能为空的问题

### v1.2

🔴更新系统配置订阅模块，请注意更新系统配置
🔴让教程正常工作需要为教程配置分类
🔴使用Aurora和Poseidon服务端的同学需要同步更新服务端至最新版本
🟡️移除user表enable字段
🟢修复用户管理筛选用户邀请的问题
🟢修复如果用户存在专属优惠还以原价计算日均价的问题
🟢修复邮件白名单依然存在的问题
🟢修复佣金状态无法更改为已完成的问题
🟢修复订阅规则空导致服务端无法启动的问题
🟢修复当面付可能不会弹出二维码的问题
🟢修复公告轮播在特定情况点击无反应的问题
🟢修复Clash无法选择auto，fallback组的问题
💡现在支持ClashForAndroid订阅
💡现在订阅更改权限组时拥有该订阅的用户权限组将同步更新
💡现在订阅支持一次性贩售（按量、按周期贩售）
💡现在教程支持分类
💡现在你可以决定每月1号或者订单日进行流量重置
💡现在你可以决定续费是否重置流量了
💡现在你可以在resources/rules目录下新建xxx.clash.yaml文件自定义clash规则了(xxx是文件名)
💡现在请求过多的时候不会提示Too many attempts了，变得更友好了
💡现在Stripe支持USD以及SGD了



# 术语

V2Board很多的术语与其他面板不同，为了保证阅读性，希望在阅读前先了解其术语，避免在阅读沟通过程中产生异议。

**前端**
V2Board的UI层，展示数据与用户交互的界面，前端分为管理端及用户端，用户端您可以自行重构或者定制来个性化自己的站点。

**后端**
V2Board的API，与前端进行数据交互。

**服务端**
用于节点(落地端)与V2Board通讯应用，在其他面板称"后端"

**客户端**
客户使用的连接应用



# 环境要求

最低配置要求为1Core/512M RAM

| 环境  | 版本   |
| :---- | :----- |
| php   | >=7.3  |
| nginx | >=1.17 |
| mysql | 5.x    |
| redis | ☑️      |

以上环境有替代品亦可，例如nginx你可以使用caddy

以上环境版本号均为最低要求



# 使用aaPanel手动部署

aaPanel是宝塔([bt.cn](http://bt.cn/))的国际版本

## 1.配置aaPanel

你需要在 [aaPanel](https://forum.aapanel.com/d/9-aapanel-linux-panel-6-5-4-installation-tutorial) 选择你的系统获得安装方式。这里以 CentOS 7+ 作为系统环境进行安装。

请务必使用 **CentOS 7+** 安装aaPanel，其他系统可能会有未知问题。

bash

```
// 最新脚本可以在aaPanel官网获取
yum install -y wget && wget -O install.sh http://www.aapanel.com/script/install_6.0_en.sh && bash install.sh
```

安装完成后我们登陆 aaPanel 进行环境的安装。

选择使用LNMP的环境安装方式勾选如下信息

☑️ Nginx 1.17
☑️ MySQL 5.6
☑️ PHP 7.4

选择 Fast 快速编译后进行安装。

## 2.安装Redis、fileinfo

aaPanel 面板 > App Store > 找到PHP 7.4点击Setting > Install extentions > redis,fileinfo 进行安装。

## 3.解除被禁止的函数

aaPanel 面板 > App Store > 找到PHP 7.4点击Setting > Disabled functions 将 `putenv` `proc_open` `pcntl_alarm` `pcntl_signal` 从列表中删除。

## 4.添加站点

aaPanel 面板 > Website > Add site。

> 在 Domain 填入你指向服务器的域名
> 在 Database 选择MySQL
> 在 PHP Verison 选择PHP-74

## 5.安装V2Board

通过SSH登录到服务器后访问站点路径如：/www/wwwroot/你的站点域名。

以下命令都需要在站点目录进行执行。

bash

```
# 删除目录下文件
chattr -i .user.ini
rm -rf .htaccess 404.html index.html .user.ini
```

执行命令从 Github 克隆到当前目录。

```
git clone https://github.com/v2board/v2board.git ./
```

执行命令安装依赖包以及V2board

```
sh init.sh
```

根据提示完成安装

## 6.配置站点目录及伪静态

添加完成后编辑添加的站点 > Site directory > Running directory 选择 /public 保存。

添加完成后编辑添加的站点 > URL rewrite 填入伪静态信息。



```
location /downloads {
}

location / {  
    try_files $uri $uri/ /index.php$is_args$query_string;  
}

location ~ .*\.(js|css)?$
{
    expires      1h;
    error_log off;
    access_log /dev/null; 
}
```

## 7.配置定时任务

aaPanel 面板 > Cron。

> 在 Type of Task 选择 Shell Script
> 在 Name of Task 填写 v2board
> 在 Period 选择 N Minutes 1 Minute
> 在 Script content 填写 php /www/wwwroot/路径/artisan schedule:run

根据上述信息添加每1分钟执行一次的定时任务。

## 8.启动队列服务

V2board的系统强依赖队列服务，正常使用V2Board必须启动队列服务。下面以aaPanel中supervisor服务来守护队列服务作为演示。

aaPanel 面板 > App Store > Tools

找到Supervisor进行安装，安装完成后点击`设置 > Add Daemon`按照如下填写

> 在 Name 填写 V2board
> 在 Run User 选择 www
> 在 Run Dir 选择 站点目录 在 Start Command 填写 php artisan horizon 在 Processes 填写 1

填写后点击Confirm添加即可运行。

### 常见问题

Q：500错误
A：检查站点根目录权限，递归755，保证目录有可写文件的权限，也有可能是Redis扩展没有安装或者Redis没有按照造成的。你可以通过查看storage/logs下的日志来排查错误或者开启debug模式、站点设置中关闭防跨站。



# 用户

用户管理的基本使用

### 过滤器

没有使用过滤器过滤的数据选择操作将会对所有数据进行操作，如果使用过滤器过滤后进行操作将会对过滤后的数据进行操作。

### 常见问题

Q：不能删除用户？
A：目前还不能删除用户，用户信息与各表依赖较强，不建议删除。可以进行封禁。



# 订阅[#](https://v2board.com/use/subscribe.html#订阅)

本页将会告诉你一些V2Board的特性避免你踩坑

### 订阅周期[#](https://v2board.com/use/subscribe.html#订阅周期)

订阅分为按周期、按量的订阅方式。按周期订阅的话将会在用户到期日（如5月10日到期则到期日为每月10日）或每月1日进行流量重置，按量的话流量将不会限制，直到流量用完后才会对用户进行停止。可以通过配置重置流量包后用户购买重置流量包对当月流量进行重置。

### 订阅折抵

订阅折抵的前提是用户拥有有效且在有效期内的订单，将会根据订单支付金额计算进行折抵。

购买相同订阅则为续费，将会在原有的订阅上延长时间。
购买不同订阅则为更换订阅更换订阅后，如果当前订阅还有剩余价值则会进行0损耗折算，折算方式如下：

按量折算方式为：10元10G使用5G则退款5元
按周期折算方式：10元每月用了半个月退款5元

变更成功后将会更换至新的订阅。

### 订阅清空流量

当购买订阅或者续费订阅时发生如下几种情况会触发清空流量的动作

1.购买一次性（按量）订阅时都将会触发
2.由一次性订阅转换到循环订阅时将会触发
3.用户购买了重置流量包
4.订阅过期后重新购买将触发
5.在系统配置-》订阅-》配置了清空流量的事件

### 订阅重置方式

目前系统有两种订阅重置方式，可以在系统配置-》订阅找到-》月流量重置方式。可以单独对套餐设置重置方式。

1.每月1号：顾名思义每月1日0时将会对有效用户的流量进行重置。
2.订单日：订单日实际上并不是以用户最后产生的订单为重置日期，而是用户过期的日期，举例用户6月4日到期，那么将会在每月的4日进行流量重置。 3.不重置：任意情况下均不会重复，除非触发设置的重置事件。

### 常见问题

Q：购买后状态处于开通中
A：请检查计划任务是否可用且有效，V2Board诸多服务依赖于计划任务，如果你没有配置的话订单或佣金分配都将出现问题。



# 节点

本文会解答你使用V2Board配置节点中部分问题。

### V2Board支持的协议

V2Board目前支持以下协议：

- Shadowsocks
- Vmess
- Trojan

### 支持订阅的客户端

自动订阅 ☑️：客户端请求时携带的UA可以让V2board知道客户端的类型进行处理。
自动订阅 ❌：客户端请求V2Board无法识别需要携带参数指定识别码请求，如v2rayng请在订阅后加上`&flag=v2rayng`

| 客户端       | Shadowsocks | V2ray | Trojan | 自动订阅 | 识别码         |
| :----------- | :---------- | :---- | :----- | :------- | :------------- |
| Clash        | ☑️           | ☑️     | ☑️      | ☑️        | clash          |
| Shadowrocket | ☑️           | ☑️     | ☑️      | ☑️        | shadowrocket   |
| Surge        | ☑️           | ☑️     | ☑️      | ☑️        | surge          |
| QuantumultX  | ☑️           | ☑️     | ☑️      | ☑️        | quantumult%20x |
| Surfboard    | ☑️           | ☑️     | ☑️      | ☑️        | surfboard      |
| V2rayNG      | ☑️           | ☑️     | ☑️      | ❌        | v2rayng        |
| V2rayN       | ☑️           | ☑️     | ☑️      | ❌        | v2rayn         |
| Passwall     | ☑️           | ☑️     | ☑️      | ❌        | passwall       |
| SSRPlus      | ☑️           | ☑️     | ☑️      | ❌        | ssrplus        |
| Shadowsocks  | ☑️           | ❌     | ❌      | ☑️        | shadowsocks    |
| AnXray       | ☑️           | ☑️     | ☑️      | ☑️        | aaxray         |
| Stash        | ☑️           | ☑️     | ☑️      | ☑️        | stash          |

### 连接端口和服务端口有什么区别

连接端口是用户连接所使用的端口，服务端口为节点提供服务所使用的端口。假设你有一台中转服务器将A服务器1234端口数据转发到B服务器4567端口，那么用户连接A服务器，而服务部署于B服务器。

### 父节点与子节点关系

一般只有多入口单出口（多中转单落地）的情况下才会使用到。

**父节点**
父节点用于服务端获取节点配置及客户端连接所使用，假设使用的是官方的服务端只需要在V2Board进行节点配置无需额外在服务端进行配置，配置将会自动从V2Board获取一键部署。

**子节点**
子节点继承父节点的节点状态以便显示正确的节点状态展示给用户，参数配置只做为客户端连接使用，不会与服务端进行交互。节点倍率同步父节点。

**中转例子**
假设我给落地端配置443端口，那么我先在父节点配置好落地服务器并且保证可以连接到落地端，随后我们将中转端口10443转发至落地443端口，那么我只需要复制一个子节点把地址改成中转地址，端口改成10443让用户连接到中转即可。

### 权限组

权限组像是用户和节点的桥梁，部署服务端时，服务端将会从节点配置的权限组中拉取组中的用户。用户在订阅时也只会显示有权限的节点。

### 节点状态指示灯含义

蓝色：节点一切正常
黄色：节点可用，但节点没有人使用或有人使用但是没有数据上报到V2Board
红色：节点不可用，节点没有从V2Board获取到数据

### 路由

在 1.7.0 版本中，我们新增了路由功能以取代审计功能。当匹配到指定规则时他将执行指定动作。

举例：我将屏蔽 [example.com](http://example.com/) 的访问或域名包含 [example.com](http://example.com/) 的访问，那么创建路由时匹配域名填写 `*.example.com` 即可，动作为 禁止访问。

路由创建后需配置节点进行应用。



# 支付

### 支付插件

你可以参考`app/Payments/`目录下的支付插件自行开发插件模块，放入`app/Payments/`后将会自动加载在后台可以进行配置。

### 常见问题

Q：设置了Cloudflare无法收到付款？
A：添加支付配置后会生成随机的通知地址，请配置Cloudflare允许此通知地址路径的请求。

# 邮件

### 配置SMTP发件

后台->系统配置->邮件，可以对邮件服务进行配置。配置前你需要了解什么是SMTP服务，可以在google了解到。

### 自定义邮件模板

除了系统内置的模板，你可以创建你自己的模板进行使用。

首先你需要前往 **/resources/views/mail** ，这个目录下存放着邮件模板主题，你可以复制default主题并重命名为自己的主题名字对主题内的 **.blade.php** 文件进行修改。

| 文件名        | 名称                     |
| :------------ | :----------------------- |
| notify        | 用于自定义内容通知的模板 |
| remindExpire  | 过期通知模板             |
| remindTraffic | 流量告警通知模板         |
| verify        | 邮件验证模板             |

创建完成后回到后台->系统配置->邮件->邮件模板，即可看到你定义的邮件模板

### 常见问题

Q：如何跟踪错误信息？
A：数据库 `email_log` 表中有详细的错误信息。在后台也可以进行发件测试，测试结果中会告知错误。

# 邀请返佣

### 邀请返佣

邀请比例可以在后台->系统配置->邀请&佣金进行配置。
系统配置中的邀请佣金为所有用户生效，假设设置10%的佣金比例，价值100元的订阅将会给到邀请人10元的佣金。
你可以在用户管理对用户单独进行佣金比例的设置。

### 佣金的发放

佣金将会有3天的确认期，确认期一过如果管理员未对手动邀请佣金进行确认或驳回，那么将会自动确认。该设置可以在后台进行关闭。
确认后佣金将会到达用户的佣金账户中。

### 三级分销

三级分销可以在后台->系统配置->邀请&佣金开启进行配置。
举例设置：
比例为：50%，30%，20%
系统的佣金比例为10%
A邀请B邀请C邀请D，D购买100元的套餐套餐后将会对C发放5元的佣金，对B发放3元佣金，对A发放2元佣金。

# 知识库

V2board内置的知识库功能，配合自带变量和展现形式方便你对教程进行管理，用户更容易上手。

### 基本

你可以在知识库编辑器使用 **HTML** 或 **Markdown** 进行写作。

跳转函数：`jump(知识库文章ID)`
复制函数：`copy(string)`

### 仅为有效用户显示

你可以在文档编辑器中使用以下语法，可以仅对订阅处于有效的用户展示区域内的内容。



```
<!--access start-->
展示内容...
<!--access end-->
```

### 最佳实践

1.你可以结合订阅地址在知识库中写出任意客户端类型的意见订阅，比如在订阅地址后边加上客户端flag



```
{{subscribeUrl}}&flag=v2rayng
```

2.你可以在自定义订阅有效内容中加上任何类型的账号密码，他们将只会被有效用户看到。



# Telegram

V2Board内置Telegram功能介绍。

### 如何配置

**第一步**
Telegram联系@botfather创建机器人Token，创建后填入V2Board后台管理->Telegram->机器人Token

**第二步**
配置完成第一步后点击V2Board后台管理->Telegram->一键设置

**第三步**
V2Board后台管理->Telegram->开启机器人通知

### 支持指令

| 指令          | 参数     | 描述                                       |
| :------------ | :------- | :----------------------------------------- |
| /help         | 无       | 获取帮助信息，未匹配到指令时默认触发该指令 |
| /traffic      | 无       | 查看流量信息                               |
| /bind         | 订阅地址 | 绑定Telegram                               |
| /getlatesturl | 无       | 获取最新的站点地址                         |
| /unbind       | 无       | 解除绑定                                   |

### 通知

| 通知项目                    | 是否支持 |
| :-------------------------- | :------- |
| 管理员工单通知              | ☑️        |
| 客户支付通知                | ☑️        |
| forward工单通知进行快速回复 | ☑️        |

### 常见问题

Q：Bad Request: bad webhook: HTTPS url must be provided for webhook
A：不要在CDN或者其他中继层配置SSL，需要在部署网站的服务器配置SSL。

Q：发送消息给机器人没有得到答复？
A：首先先确保设置了Webhook，设置完成后如果没有收到请检查防火墙是否拦截了telegram的通知。



# 进阶

### 前端分离

V2Board的前端文件可以从V2Board分离出来进行部署，这是V2Board的一点特色，可以提升用户的访问体验。

前端目前分为2端

- [用户](https://github.com/v2board/v2board-user/releases)
- [管理员](https://github.com/v2board/v2board-admin/releases)

你可以选择对应的V2Board版本对这两个前端分别进行部署

部署方式非常简单，你只需要下载或者克隆到HTML站点并配置`env.example.js`并重命名为`env.js`即可完成

### Clash配置文件自定义

首先你需要前往 **/resources/rules** ，这个目录下存放着订阅软件相关配置文件

复制一份`default.clash.yaml`重命名为`custom.clash.yaml`并且配置成自己想要的形式，其中`$app_name`参数为站点名称可以参考默认配置文件配置。保存后将会优先使用`custom.clash.yaml`，需要恢复默认配置删除即可。

后续V2board进行更新则不会覆盖该配置。

参考下列示例可以对Proxies进行过滤



```
proxy-groups:
  - { name: "$app_name", type: select, proxies: ["自动选择", "故障转移"] }
  - { name: "自动选择", type: url-test, proxies: [], url: "http://www.gstatic.com/generate_204", interval: 86400 }
  - { name: "故障转移", type: fallback, proxies: [], url: "http://www.gstatic.com/generate_204", interval: 7200 }
  // 使用正则将节点名称包含香港的节点分配到这个规则中
  - { name: "香港", type: select, proxies: [/香港/, "自动选择"] }
```

### 客户端的适配

市面上形形色色的客户端均可以通过参考 `app/Http/Controllers/Client/Protocols/` 目录下文件进行配置。

### 常见问题

Q：前后端分离后登陆后立马退出是怎么回事？
A：前段使用的域名跟后端使用的域名必须是同一个根域。



# 服务端

你可以使用以下服务端接入V2Board，与V2Board进行通讯。

## 由官方维护的服务端

由V2board团队成员进行维护，仅支持V2board，跟随v2board第一时间更新。

```
Shadowsocks
项目群组：https://t.me/tidal_lab
```

```
V2ray
项目地址：https://github.com/tokumeikoi/aurora
项目群组：https://t.me/tidal_lab
```

```
Trojan
项目地址：https://github.com/tokumeikoi/tidalab-trojan
项目群组：https://t.me/tidal_lab
```

## 由第三方维护的服务端

除了V2Board官方的服务端以外，你可以选择其他非V2Board官方的服务端，任何技术支援与V2Board无关，请联系服务端开发者。



# 主题

在V2board中其实没有主题概念的，用户侧为SPA(single-page application)应用，而V2Board仅提供API接口。任何有前端开发能力的均可以开发用户侧进行接入。

### 主题目录

public/theme
任何符合规范的主题可以放置目录下，前往后台站点配置-》前端进行主题的选择。



# 更新升级

V2Board强依赖git，所以你如果要进行操作请务必是使用git的形式进行部署。

### 升级至稳定版

站点目录下执行

```
sh update.sh
```

### 升级至开发版

请注意升级到开发版本后无法退回，升级前请务必做好备份做事以便回滚

```
sh update_dev.sh
```

⚠️如果有额外要求需要重启队列服务，您可以对您队列服务的守护服务进行重启，例如PM2或Supervisor。

### 备份重装

备份数据库及 config/v2board.php 文件后全新安装v2board恢复文件即可完成重装。

### 常见问题

Q：更新完成后没有变化？
A：如果你使用的是CDN请检查清除CDN缓存。

Q：非git部署如何更新？
A：你可以到仓库下载最新版本的代码包全量覆盖更新。覆盖后请务必执行 **php artisan v2board:update**

Q：如何降级？
A：降级前必须要有数据库备份，否则将会导致问题。重装指定版本，导入指定版本数据库。
